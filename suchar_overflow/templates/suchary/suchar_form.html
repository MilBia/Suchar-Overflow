{% extends "base.html" %}

{% load i18n %}

{% load static %}

{% block title %}
  {% trans "Add Joke" %}
{% endblock title %}

{% block css %}
  {{ block.super }}
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
  <link rel="stylesheet" href="{% static 'css/pages/suchar_form.css' %}" />
{% endblock css %}

{% block content %}
  <div class="row py-5 gx-5 suchar-form-wrapper">
    <!-- Left Column: Form -->
    <div class="col-lg-6 mb-5 mb-lg-0">
      <div class="card shadow-lg border-0 rounded-4 glass-card h-100">
        <div class="card-body p-4 p-md-5">
          <div class="d-flex align-items-center gap-3 mb-4">
            <div class="avatar bg-gradient-primary rounded-circle p-3 d-inline-flex text-white shadow-sm">
              {% include "svgs/icon-edit.svg" %}
            </div>
            <div>
              <h2 class="fw-bold mb-0 h3">{% trans "Add Joke" %}</h2>
              <p class="text-muted mb-0 small">{% trans "Shine with humor." %}</p>
            </div>
          </div>

          <form method="post">
            {% csrf_token %}

            <div class="mb-4">
              <label for="id_text" class="form-label fw-bold">{% trans "Joke Content" %}</label>
              <textarea name="text"
                        cols="40"
                        rows="10"
                        class="form-control form-control-lg"
                        placeholder="{% trans 'Why did the chicken cross the road?' %}"
                        required
                        id="id_text">{{ form.text.value|default_if_none:'' }}</textarea>
              <div class="form-text">{% trans "Remember, the drier the better." %}</div>
            </div>

            <div class="mb-4">
              <label for="id_tags_input" class="form-label fw-bold">{% trans "Tags" %}</label>
              <div class="custom-dropdown w-100" id="tags-dropdown">
                <input type="text"
                       name="tags_input"
                       class="form-control"
                       placeholder="{% trans 'e.g. it, programming, school' %}"
                       id="id_tags_input"
                       value="{{ form.tags_input.value|default_if_none:'' }}"
                       autocomplete="off" />
                <!-- Suggestions Box managed by JS -->
                <div id="tags-suggestions" class="dropdown-menu w-100"></div>
              </div>
              <div class="form-text">{% trans "Separate with commas." %}</div>
            </div>

            <!-- Scheduling Section (Moved to bottom) -->
            <div class="mb-4 p-3 bg-light bg-opacity-10 rounded-3 border border-secondary border-opacity-25">
              <div class="d-flex flex-wrap align-items-center gap-3">
                <div class="form-check form-switch mb-0">
                  <input class="form-check-input" type="checkbox" id="scheduleCheck" />
                  <label class="form-check-label fw-bold" for="scheduleCheck">{% trans "Schedule for later" %}</label>
                </div>

                <div id="scheduleContainer" class="schedule-wrapper d-none flex-grow-1">
                  <div class="d-flex align-items-center gap-2">
                    <input type="text"
                           name="published_at"
                           class="form-control flatpickr-input"
                           id="id_published_at"
                           placeholder="{% trans 'Select date and time...' %}"
                           value="{{ form.published_at.value|date:'Y-m-d H:i' }}" />
                  </div>
                  <div class="invalid-feedback d-none" id="dateError"></div>
                </div>
              </div>
            </div>

            <div class="d-grid gap-3 mt-5">
              <button type="submit" class="btn btn-primary btn-lg shadow-sm">{% trans "Publish" %}</button>
              <a href="{% url 'suchary:list' %}" class="btn btn-outline text-muted">{% trans "Cancel" %}</a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Right Column: Live Preview -->
    <div class="col-lg-6">
      <div class="sticky-preview">
        <h6 class="text-uppercase text-muted fw-bold mb-3 small tracking-wide">{% trans "Live Preview" %}</h6>

        <!-- Preview Card (Matches suchar_list.html structure) -->
        <div class="card suchar-card shadow-sm border-0">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div class="d-flex align-items-center">
                <div class="avatar-sm flex-shrink-0 me-3">{% include "svgs/icon-user.svg" %}</div>
                <div>
                  <h6 class="mb-0 fw-bold">{{ user.display_name }}</h6>
                  <small class="suchar-meta">{% trans "Now" %}</small>
                </div>
              </div>
            </div>

            <!-- Preview Content -->
            <p class="mb-4 preview-text text-muted fst-italic" id="previewText">
              {% trans "Your joke content will appear here..." %}
            </p>

            <!-- Preview Tags -->
            <div class="mb-3" id="previewTags">
              <!-- Badges will require JS -->
            </div>

            <div class="d-flex align-items-center justify-content-between border-top pt-3 opacity-50">
              <div class="d-flex align-items-center">
                <span class="vote-score me-3 d-flex align-items-center gap-2 text-muted">
                  <!-- Static Icon for preview -->
                  <svg xmlns="http://www.w3.org/2000/svg"
                       width="20"
                       height="20"
                       fill="currentColor"
                       class="text-secondary"
                       viewBox="0 0 16 16">
                    <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                  </svg>
                  0
                </span>
              </div>
              <div class="d-flex gap-2">
                <button class="btn btn-icon btn-vote" disabled>{% include "svgs/icon-vote-up.svg" %}</button>
                <button class="btn btn-icon btn-vote" disabled>{% include "svgs/icon-vote-down.svg" %}</button>
              </div>
            </div>
          </div>
        </div>

        <div class="card mt-4 bg-transparent border-0">
          <div class="card-body p-0 text-center text-muted small">
            <p>{% trans "This is how your joke will look on the main list." %}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

{% endblock content %}

{% block javascript %}
  {{ block.super }}
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script defer src="{% static 'js/pages/suchar_form.js' %}"></script>
{% endblock javascript %}
