{% extends "base.html" %}

{% block title %}
  Suchary
{% endblock title %}
{% block content %}
  <div class="container py-4">
    <div class="row align-items-center mb-5 gy-4">
      <div class="col-lg-4">
        <h1 class="fw-bold text-primary mb-0">Suchary</h1>
        <p class="text-muted mb-0">Najsuchsze żarty w internecie.</p>
      </div>
      <div class="col-lg-8">
        <form method="get"
              class="d-flex align-items-center gap-2 justify-content-lg-end search-toolbar">
          {% for key, value in request.GET.items %}
            {% if key != 'q' and key != 'sort' %}<input type="hidden" name="{{ key }}" value="{{ value }}" />{% endif %}
          {% endfor %}

          <!-- Search Input Group with attached button -->
          <div class="input-group flex-nowrap align-items-stretch search-input-group">
            <input type="text"
                   name="q"
                   class="form-control mb-0 rounded-end-0"
                   style="border-right: 0"
                   placeholder="Szukaj..."
                   aria-label="Search"
                   value="{{ request.GET.q|default:'' }}" />
            <button class="btn btn-secondary border-start-0 ps-2 rounded-start-0 d-flex align-items-center"
                    type="submit">
              <svg xmlns="http://www.w3.org/2000/svg"
                   width="16"
                   height="16"
                   fill="currentColor"
                   viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
              </svg>
            </button>
          </div>

          <!-- Sort Select -->
          <select name="sort"
                  class="form-select mb-0 search-sort-select"
                  onchange="this.form.submit()">
            <option value="newest"
                    {% if not request.GET.sort or request.GET.sort == 'newest' %}selected{% endif %}>
              Najnowsze
            </option>
            <option value="top" {% if request.GET.sort == 'top' %}selected{% endif %}>Najlepsze</option>
          </select>

          <!-- Add Button -->
          <a href="{% url 'suchary:add' %}"
             class="btn btn-primary d-flex align-items-center text-nowrap">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="20"
                 height="20"
                 fill="currentColor"
                 class="me-2"
                 viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2" />
            </svg>
            Dodaj
          </a>
        </form>
      </div>
    </div>
    <div class="row justify-content-center">
      <div class="col-lg-8">
        {% for suchar in suchary %}
          <div class="card suchar-card">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="d-flex align-items-center">
                  <div class="avatar-sm flex-shrink-0 me-3">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="24"
                         height="24"
                         fill="currentColor"
                         viewBox="0 0 16 16">
                      <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                    </svg>
                  </div>
                  <div>
                    <h6 class="mb-0 fw-bold">{{ suchar.author.username }}</h6>
                    <small class="suchar-meta">{{ suchar.created_at|date:"d M Y, H:i" }}</small>
                  </div>
                </div>
              </div>
              <p class="mb-4">{{ suchar.text|linebreaksbr }}</p>
              {% if suchar.tags.all %}
                <div class="mb-3">
                  {% for tag in suchar.tags.all %}
                    <a href="?tag={{ tag.slug }}"
                       class="badge text-secondary border me-1 text-decoration-none bg-light">#{{ tag.name }}</a>
                  {% endfor %}
                </div>
              {% endif %}
              <div class="d-flex align-items-center justify-content-between border-top pt-3">
                <div class="d-flex align-items-center">
                  <span class="vote-score me-3 d-flex align-items-center gap-2 text-primary">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="20"
                         height="20"
                         fill="currentColor"
                         class="text-warning"
                         viewBox="0 0 16 16">
                      <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    {{ suchar.score|default_if_none:0 }}
                  </span>
                </div>
                {% if user.is_authenticated %}
                  <form method="post"
                        action="{% url 'suchary:vote' suchar.pk %}"
                        class="d-flex align-items-center">
                    {% csrf_token %}
                    <button type="submit"
                            name="value"
                            value="1"
                            class="btn btn-icon"
                            title="Śmieszne (Głosuj w górę)">
                      <svg xmlns="http://www.w3.org/2000/svg"
                           width="20"
                           height="20"
                           fill="currentColor"
                           class="bi bi-emoji-laughing"
                           viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                        <path d="M12.331 9.5a1 1 0 0 1 0 1A4.998 4.998 0 0 1 8 13a4.998 4.998 0 0 1-4.33-2.5A1 1 0 0 1 4.535 9h6.93a1 1 0 0 1 .866.5M7 6.5c0 .828-.448 0-1 0s-1 .828-1 0S5.448 5 6 5s1 .672 1 1.5m4 0c0 .828-.448 0-1 0s-1 .828-1 0S9.448 5 10 5s1 .672 1 1.5" />
                      </svg>
                    </button>
                    <button type="submit"
                            name="value"
                            value="-1"
                            class="btn btn-icon"
                            title="Suchar (Głosuj w dół)">
                      <svg xmlns="http://www.w3.org/2000/svg"
                           width="20"
                           height="20"
                           fill="currentColor"
                           class="bi bi-emoji-neutral"
                           viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                        <path d="M4 10.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7a.5.5 0 0 0-.5.5m3-4C7 5.672 6.552 5 6 5s-1 .672-1 1.5S5.448 8 6 8s1-.672 1-1.5m4 0c0-.828-.448-1.5-1-1.5s-1 .672-1 1.5S9.448 8 10 8s1-.672 1-1.5" />
                      </svg>
                    </button>
                  </form>
                {% endif %}
              </div>
            </div>
          </div>
        {% empty %}
          <div class="text-center py-5">
            <div class="mb-3 text-muted">
              <svg xmlns="http://www.w3.org/2000/svg"
                   width="48"
                   height="48"
                   fill="currentColor"
                   class="bi bi-wind"
                   viewBox="0 0 16 16">
                <path d="M12.5 2A2.5 2.5 0 0 0 10 4.5a.5.5 0 0 1-1 0A3.5 3.5 0 1 1 12.5 8H.5a.5.5 0 0 1 0-1h12a2.5 2.5 0 0 0 0-5m-7 1a1 1 0 0 0-1 1 .5.5 0 0 1-1 0 2 2 0 1 1 2 2h-5a.5.5 0 0 1 0-1h5a1 1 0 0 0 0-2" />
              </svg>
            </div>
            <h3>Ale tu sucho...</h3>
            <p class="text-muted">Bądź bohaterem, którego potrzebujemy i dodaj pierwszego suchara.</p>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% if is_paginated %}
    <div class="row mt-4">
      <div class="col-12">
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.tag %}&tag={{ request.GET.tag }}{% endif %}">Poprzednia</a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <span class="page-link">Poprzednia</span>
              </li>
            {% endif %}
            {% for i in paginator.page_range %}
              {% if page_obj.number == i %}
                <li class="page-item active">
                  <span class="page-link">{{ i }}</span>
                </li>
              {% else %}
                <li class="page-item">
                  <a class="page-link"
                     href="?page={{ i }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.tag %}&tag={{ request.GET.tag }}{% endif %}">
                    {{ i }}
                  </a>
                </li>
              {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.tag %}&tag={{ request.GET.tag }}{% endif %}">Następna</a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <span class="page-link">Następna</span>
              </li>
            {% endif %}
          </ul>
        </nav>
      </div>
    </div>
  {% endif %}
{% endblock content %}
