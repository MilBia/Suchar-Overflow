{% extends "users/base_dashboard.html" %}

{% load static %}

{% block title %}
  User: {{ object.username }}
{% endblock title %}
{% block dashboard_content %}
  <div class="card shadow-lg border-0 h-100 overflow-hidden">
    <!-- Hero Cover -->
    <div class="profile-cover"></div>

    <div class="card-body p-0">
      <div class="px-4 px-lg-5 pb-5">
        <!-- Avatar & Header -->
        <div class="d-flex align-items-end mb-4 profile-header-wrapper">
          <div class="avatar-profile flex-shrink-0 me-4">{% include "svgs/icon-user.svg" %}</div>
          <div class="mb-2">
            <h2 class="h2 fw-bold mb-0">{{ object.username }}</h2>
            {% if object.name %}
              <p class="text-muted mb-0">{{ object.name }}</p>
            {% else %}
              <p class="text-muted mb-0">Użytkownik Suchar Overflow</p>
            {% endif %}
          </div>
        </div>

        <div class="row g-4">
          <!-- Stats Column -->
          <div class="col-md-4 col-xl-3">
            <div class="card border bg-light h-100">
              <div class="card-body">
                <h6 class="text-uppercase text-muted small fw-bold mb-3">Statystyki</h6>
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span>Suchary</span>
                  <span class="fw-bold">{{ latest_suchary.count|default:"0" }}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span>Polubienia</span>
                  <!-- Placeholder for total score if available, or just remove ID -->
                  <span class="fw-bold text-success">{{ object.total_score|default:"-" }}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                  <span>Dołączył</span>
                  <span>{{ object.date_joined|date:"M Y" }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Feed Column -->
          <div class="col-md-8 col-xl-9">
            <h4 class="h5 fw-bold mb-3 d-flex align-items-center gap-2">
              <span class="text-primary">{% include "svgs/icon-edit.svg" %}</span>
              Ostatnie Suchary
            </h4>

            {% if latest_suchary %}
              <div class="d-flex flex-column gap-3">
                {% for suchar in latest_suchary %}
                  <!-- Ensure vertical stacking with w-100 -->
                  <div class="card border-0 bg-light card-hover-sm w-100 d-block">
                    <div class="card-body p-3">
                      <p class="mb-2">{{ suchar.text|truncatechars:120 }}</p>
                      <small class="text-muted">{{ suchar.created_at|date:"d M Y, H:i" }}</small>
                    </div>
                  </div>
                {% endfor %}
              </div>
              <div class="mt-3">
                <a href="{% url 'suchary:list' %}?author={{ object.username }}"
                   class="btn btn-outline btn-sm">Zobacz wszystkie wpisy</a>
              </div>
            {% else %}
              <div class="text-center py-5 bg-light rounded-4">
                <p class="text-muted mb-0">Użytkownik nie dodał jeszcze żadnych sucharów.</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock dashboard_content %}
